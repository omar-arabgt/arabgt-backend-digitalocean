{% extends "web/partials/base.html" %}
{% load static %}
{% load custom_filters %} 
{% block title %}التفاصيل{% endblock %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<div class="container mx-auto py-10 px-16">
  <a href="{%url 'questions'%}" class="absolute right-7 top-16">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M2.25 12C2.25 6.61704 6.61704 2.25 12 2.25C17.383 2.25 21.75 6.61704 21.75 12C21.75 17.383 17.383 21.75 12 21.75C6.61704 21.75 2.25 17.383 2.25 12ZM12 3.75C7.44546 3.75 3.75 7.44546 3.75 12C3.75 16.5545 7.44546 20.25 12 20.25C16.5545 20.25 20.25 16.5545 20.25 12C20.25 7.44546 16.5545 3.75 12 3.75Z" fill="#1E293B"/>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M8.46967 8.46967C8.76256 8.17678 9.23744 8.17678 9.53033 8.46967L15.5303 14.4697C15.8232 14.7626 15.8232 15.2374 15.5303 15.5303C15.2374 15.8232 14.7626 15.8232 14.4697 15.5303L8.46967 9.53033C8.17678 9.23744 8.17678 8.76256 8.46967 8.46967Z" fill="#1E293B"/>
      <path fill-rule="evenodd" clip-rule="evenodd" d="M15.5303 8.46967C15.8232 8.76256 15.8232 9.23744 15.5303 9.53033L9.53033 15.5303C9.23744 15.8232 8.76256 15.8232 8.46967 15.5303C8.17678 15.2374 8.17678 14.7626 8.46967 14.4697L14.4697 8.46967C14.7626 8.17678 15.2374 8.17678 15.5303 8.46967Z" fill="#1E293B"/>
    </svg>
  </a>
    
    {% include "web/partials/heading.html" with title="التفاصيل" %}
    
    <div class="bg-white shadow-md mb-6 border-t border-gray-200">
        <div class="p-4 flex justify-between items-start">
            <div>
                <div class="text-gray-500 mb-3 items-center flex gap-2">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="0.5" y="0.5" width="23" height="23" rx="11.5" fill="#EBEBEC"/>
                    <rect x="0.5" y="0.5" width="23" height="23" rx="11.5" stroke="#E2072C"/>
                    <path d="M14.3337 9.08333C14.3337 10.372 13.289 11.4167 12.0003 11.4167C10.7117 11.4167 9.66699 10.372 9.66699 9.08333C9.66699 7.79467 10.7117 6.75 12.0003 6.75C13.289 6.75 14.3337 7.79467 14.3337 9.08333Z" fill="#E2072C"/>
                    <path d="M12.0003 13.1667C9.74516 13.1667 7.91699 14.9948 7.91699 17.25H16.0837C16.0837 14.9948 14.2555 13.1667 12.0003 13.1667Z" fill="#E2072C"/>
                    <path d="M14.3337 9.08333C14.3337 10.372 13.289 11.4167 12.0003 11.4167C10.7117 11.4167 9.66699 10.372 9.66699 9.08333C9.66699 7.79467 10.7117 6.75 12.0003 6.75C13.289 6.75 14.3337 7.79467 14.3337 9.08333Z" stroke="#E2072C" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12.0003 13.1667C9.74516 13.1667 7.91699 14.9948 7.91699 17.25H16.0837C16.0837 14.9948 14.2555 13.1667 12.0003 13.1667Z" stroke="#E2072C" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  {{ question.user.username }}
                  <div class="text-gray-400 text-sm">{{ question.created_at|arabic_timesince }}</div>
                </div>
                <h2 class=" text-gray-600 mb-4">{{ question.content }}</h2>
                {% if question.file %}
                  <div class="mt-4">
                      <img src="{{ question.file.url }}" alt="Question Image" class="w-60 h-auto">
                  </div>
                {% endif %}
            </div>
            <div>
              <button type="button" class="text-black font-bold flex gap-2 text-sm" onclick="question_openModal()">
                  حذف المنشور
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M21 4H8L1 12L8 20H21C21.5304 20 22.0391 19.7893 22.4142 19.4142C22.7893 19.0391 23 18.5304 23 18V6C23 5.46957 22.7893 4.96086 22.4142 4.58579C22.0391 4.21071 21.5304 4 21 4V4Z" stroke="#E2072C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M18 9L12 15" stroke="#E2072C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M12 9L18 15" stroke="#E2072C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
              </button>
            </div>
            <div id="question_confirmationModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden" style="z-index: 99999999;">
                <div class="bg-white rounded-lg px-16 py-6 shadow-lg">
                    <h2 class="text-xl text-center text-red-600 font-bold mb-6">تأكيد الحذف</h2>
                    <p>هل أنت متأكد أنك تريد حذف هذا المنشور؟</p>
                    <div class="flex gap-4 justify-between mt-6">
                        <form method="POST" action="{% url 'delete_question' question.id %}" class="w-full">
                            {% csrf_token %}
                            <button type="submit" class="border-2 border-red-600 hover:bg-red-600 hover:text-white text-red-600 font-bold py-2 px-12 rounded">حذف</button>
                        </form>
                        <button class="agt-bg-red-900 hover:bg-red-700 text-white font-bold py-2 px-12 rounded" onclick="question_closeModal()">إلغاء</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-gray-50 p-4 border-b border-t border-gray-200 flex justify-between items-center">
            <div class="text-gray-700 flex items-center space-x-4 space-x-reverse">
                <span class="flex items-center space-x-1 space-x-reverse">
                    <svg width="20" height="21" viewBox="0 0 20 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M5.83366 18.8346H3.33366C2.89163 18.8346 2.46771 18.659 2.15515 18.3465C1.84259 18.0339 1.66699 17.61 1.66699 17.168V11.3346C1.66699 10.8926 1.84259 10.4687 2.15515 10.1561C2.46771 9.84356 2.89163 9.66797 3.33366 9.66797H5.83366M11.667 8.0013V4.66797C11.667 4.00493 11.4036 3.36904 10.9348 2.9002C10.4659 2.43136 9.83003 2.16797 9.16699 2.16797L5.83366 9.66797V18.8346H15.2337C15.6356 18.8392 16.0256 18.6983 16.3319 18.438C16.6382 18.1776 16.8401 17.8154 16.9003 17.418L18.0503 9.91797C18.0866 9.6791 18.0705 9.4352 18.0031 9.20318C17.9357 8.97115 17.8187 8.75655 17.6602 8.57423C17.5017 8.39191 17.3054 8.24624 17.085 8.14732C16.8645 8.04839 16.6252 7.99857 16.3837 8.0013H11.667Z" stroke="#272727" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>{{ question.reactions.count }}</span>
                </span>
                <span class="flex items-center space-x-1 space-x-reverse">
                    <svg width="18" height="19" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M1 3.33464C1 2.69064 1.52267 2.16797 2.16667 2.16797H13.8333C14.4773 2.16797 15 2.69064 15 3.33464V11.668C15 11.9774 14.8771 12.2741 14.6583 12.4929C14.4395 12.7117 14.1428 12.8346 13.8333 12.8346H7.37333L4.99133 15.2166C4.85537 15.3521 4.68235 15.4443 4.49408 15.4815C4.30581 15.5188 4.11072 15.4995 3.93341 15.4261C3.75609 15.3526 3.60449 15.2283 3.4977 15.0689C3.39091 14.9094 3.33372 14.7219 3.33333 14.53V12.8346H2.16667C1.85725 12.8346 1.5605 12.7117 1.34171 12.4929C1.12292 12.2741 1 11.9774 1 11.668V3.33464ZM2.16667 3.16797C2.12246 3.16797 2.08007 3.18553 2.04882 3.21678C2.01756 3.24804 2 3.29043 2 3.33464V11.668C2 11.76 2.07467 11.8346 2.16667 11.8346H3.83333C3.96594 11.8346 4.09312 11.8873 4.18689 11.9811C4.28066 12.0748 4.33333 12.202 4.33333 12.3346V14.4613L6.81333 11.9813C6.8597 11.9348 6.91477 11.898 6.9754 11.8728C7.03603 11.8476 7.10102 11.8347 7.16667 11.8346H13.8333C13.8775 11.8346 13.9199 11.8171 13.9512 11.7858C13.9824 11.7546 14 11.7122 14 11.668V3.33464C14 3.29043 13.9824 3.24804 13.9512 3.21678C13.9199 3.18553 13.8775 3.16797 13.8333 3.16797H2.16667Z" fill="#333333"/>
                    </svg>                                  
                    <span>{{ total_comments }}</span>
                </span>
            </div>
        </div>
    </div>

    <div class="mr-2">
        <ul>
            {% include 'web/questions/reply.html' with replies=replies %}
        </ul>
    </div>
</div>

<script>
  function question_openModal() {
      document.getElementById('question_confirmationModal').classList.remove('hidden');
  }
  
  function question_closeModal() {
      document.getElementById('question_confirmationModal').classList.add('hidden');
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
      const toggleButtons = document.querySelectorAll('.toggle-replies');

      toggleButtons.forEach(button => {
          button.addEventListener('click', function() {
              const targetId = this.getAttribute('data-target');
              const nestedReplies = document.getElementById(targetId);

              if (nestedReplies.style.display === 'none') {
                  nestedReplies.style.display = 'block';
                  this.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 12H18" stroke="#0F172A" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>';
                } else {
                  nestedReplies.style.display = 'none';
                  this.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 6V12M12 12V18M12 12H18M12 12L6 12" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';
              }
          });
      });
  });
</script>

{% endblock %}
